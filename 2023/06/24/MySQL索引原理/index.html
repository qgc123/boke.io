

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="子川">
  <meta name="keywords" content="">
  
    <meta name="description" content="1.Mysql概述 介绍：Oracle旗下开源的最流行的关系型数据库（Relational Database Management System）管理系统。  常见面试题：  SQL与Mysql区别： SQL(Structured Query Language)是一种查询数据库的标准计算机语言，可以查询关系型数据库，包括但不限于Mysql。 Mysql是关系型数据库，支持SQL语言，但不支持全部的">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL索引原理">
<meta property="og:url" content="http://example.com/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/index.html">
<meta property="og:site_name" content="子川个人博客">
<meta property="og:description" content="1.Mysql概述 介绍：Oracle旗下开源的最流行的关系型数据库（Relational Database Management System）管理系统。  常见面试题：  SQL与Mysql区别： SQL(Structured Query Language)是一种查询数据库的标准计算机语言，可以查询关系型数据库，包括但不限于Mysql。 Mysql是关系型数据库，支持SQL语言，但不支持全部的">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/43c52a51-111e-4fda-89b0-dda8f5d1414a.png">
<meta property="og:image" content="http://example.com/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/3cd7d80a-ad09-489e-a1b6-c7aeac85cad1.png">
<meta property="og:image" content="http://example.com/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/84d18ac1-f7c3-49be-b533-28b7ccae069e.png">
<meta property="og:image" content="http://example.com/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/49278afe-ad09-402b-b1d2-f47bbf9820aa.png">
<meta property="og:image" content="http://example.com/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/9ee83e74-fffd-4868-a7a9-78da7001cb1b.png">
<meta property="og:image" content="http://example.com/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/c603392e-8c89-44f1-992d-ee36fa0f21a2.png">
<meta property="og:image" content="http://example.com/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/98dadc07-8cf8-4362-9403-1e80d1a4904d.png">
<meta property="og:image" content="http://example.com/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/image-20230624094252434.png">
<meta property="og:image" content="http://example.com/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/image-20230624094451483.png">
<meta property="og:image" content="http://example.com/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/336a7b3f-3469-4bb8-9592-2c2584412b95.png">
<meta property="og:image" content="http://example.com/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/5acc62c9-e566-4504-9058-08543f2d65ce.jpeg">
<meta property="og:image" content="http://example.com/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/image-20230624095018218.png">
<meta property="og:image" content="http://example.com/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/image-20230624095038737.png">
<meta property="og:image" content="http://example.com/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/a84807a4-42fb-4477-adfc-5ab136b63556.png">
<meta property="og:image" content="http://example.com/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/62031496-6d9c-4051-8514-24edf4aa3b0c.png">
<meta property="og:image" content="http://example.com/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/73f050bf-37a5-48f4-9505-b22d818f2d2d.png">
<meta property="og:image" content="http://example.com/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/06430fec-9f61-45d6-84a5-d6bd991416a9.png">
<meta property="og:image" content="http://example.com/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/268b086b-6fba-4728-b54c-a3d73a225074.png">
<meta property="og:image" content="http://example.com/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/268b086b-6fba-4728-b54c-a3d73a225074-1687571895894-20.png">
<meta property="og:image" content="http://example.com/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/image-20230624095852531.png">
<meta property="og:image" content="http://example.com/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/e436a165-a427-4505-b89d-c10cbe2ebb71.jpeg">
<meta property="og:image" content="http://example.com/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/4ddd953d-850b-4b13-9e46-d1bdfa7aae1a.png">
<meta property="og:image" content="http://example.com/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/a35c6b4a-a161-4ced-824b-65260247bd1f.png">
<meta property="article:published_time" content="2023-06-24T00:31:44.000Z">
<meta property="article:modified_time" content="2023-07-01T12:31:44.134Z">
<meta property="article:author" content="子川">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/43c52a51-111e-4fda-89b0-dda8f5d1414a.png">
  
  
  
  <title>MySQL索引原理 - 子川个人博客</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>子川个人博客</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="MySQL索引原理"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-06-24 08:31" pubdate>
          2023年6月24日 早上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          9.2k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          77 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">MySQL索引原理</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="1-Mysql概述"><a href="#1-Mysql概述" class="headerlink" title="1.Mysql概述"></a>1.Mysql概述</h1><ul>
<li><p>介绍：Oracle旗下开源的最流行的关系型数据库（Relational Database Management System）管理系统。</p>
</li>
<li><p>常见面试题：</p>
<ul>
<li>SQL与Mysql区别：<ul>
<li>SQL(Structured Query Language)是一种查询数据库的标准计算机语言，可以查询关系型数据库，包括但不限于Mysql。</li>
<li>Mysql是关系型数据库，支持SQL语言，但不支持全部的SQL（例如full outer join）</li>
</ul>
</li>
<li>Mysql与Oracle使用场景区别：<ul>
<li>错误答案：大公司用Oracle，小公司用mysql</li>
<li>正确答案：金融场景会使用Oracle</li>
</ul>
</li>
<li>RDMS与NoSQL的主要区别：<ul>
<li>强一致性、弱一致性</li>
<li>不可水平拓展、可水平拓展</li>
</ul>
</li>
<li>NewSQL：可水平扩展的RDMS，代替“中间件+关系型数据库分库分表”，例如TiDB、OceanBase</li>
<li>DML、DDL、DCL：数据操作语言、数据定义语言、数据控制语言</li>
</ul>
</li>
<li><p>客户端与服务端通讯方式：</p>
<ul>
<li>TCP&#x2F;IP</li>
<li>命名管道和共享内存【Windows】</li>
<li>Unix域套接字文件【Unix系】</li>
</ul>
</li>
</ul>
<p><img src="/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/43c52a51-111e-4fda-89b0-dda8f5d1414a.png" srcset="/img/loading.gif" lazyload alt="MySQL逻辑层次图"></p>
<p><strong>MysqlServer层：连接管理、解析与优化</strong> </p>
<ul>
<li>查询缓存：5.7.20不推荐，8.0删除<ul>
<li>表的任何变动都会失效</li>
<li>前后两次查询SQL完全一致</li>
</ul>
</li>
<li>语法解析</li>
<li>查询优化：<strong>执行计划等（EXPLAIN）</strong></li>
</ul>
<p><strong>存储引擎层：</strong>负责数据的存储和提取。</p>
<ul>
<li><strong>InnoDB</strong>：默认且最为常用</li>
<li><strong>MyISAM</strong></li>
<li>其他存储引擎：Memory、Archive等</li>
</ul>
<p><strong>查询计划是MysqlServer层的职责，不跟随存储引擎而改变</strong></p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">Mysql提供给存储引擎需要实现的接口实例（部分）：<br><br><span class="hljs-comment">//使用索引前调用该方法</span><br><br><span class="hljs-built_in">int</span> ha_foo::index<span class="hljs-constructor">_init(<span class="hljs-params">uint</span> <span class="hljs-params">keynr</span>, <span class="hljs-params">bool</span> <span class="hljs-params">sorted</span>)</span> <br><br><span class="hljs-comment">//使用索引后调用该方法</span><br><br><span class="hljs-built_in">int</span> ha_foo::index<span class="hljs-constructor">_end(<span class="hljs-params">uint</span> <span class="hljs-params">keynr</span>, <span class="hljs-params">bool</span> <span class="hljs-params">sorted</span>)</span><br><br><span class="hljs-comment">//读取索引第一条内容</span><br><br><span class="hljs-built_in">int</span> ha<span class="hljs-constructor">_index_first(<span class="hljs-params">uchar</span> <span class="hljs-operator">*</span> <span class="hljs-params">buf</span>)</span>;<br><br><span class="hljs-comment">//读取索引下一条内容</span><br><br><span class="hljs-built_in">int</span> ha<span class="hljs-constructor">_index_next(<span class="hljs-params">uchar</span> <span class="hljs-operator">*</span> <span class="hljs-params">buf</span>)</span>;<br><br><span class="hljs-comment">//读取索引前一条内容</span><br><br><span class="hljs-built_in">int</span> ha<span class="hljs-constructor">_index_prev(<span class="hljs-params">uchar</span> <span class="hljs-operator">*</span> <span class="hljs-params">buf</span>)</span>;<br><br><span class="hljs-comment">//读取索引最后一条内容</span><br><br><span class="hljs-built_in">int</span> ha<span class="hljs-constructor">_index_last(<span class="hljs-params">uchar</span> <span class="hljs-operator">*</span> <span class="hljs-params">buf</span>)</span>;<br></code></pre></td></tr></table></figure>

<h2 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h2><ul>
<li>Innodb与Myisam引擎的区别</li>
</ul>
<p>Myisam：支持表锁；不支持外键，事务；表的索引与数据在不同的文件；支持全文索引；允许没有主键</p>
<p>Innodb：支持行锁、表锁；支持外键，事务；表索引与数据在同一的文件；不支持全文索引（5.6+开始支持）；会有默认主键</p>
<ul>
<li>数据库的1NF、2NF、3NF：</li>
</ul>
<p>1NF：关系中每一分量不可再分。即不能以集合、序列等作为属性。大白话：列不能存多个属性</p>
<p>2NF：在1NF基础上，消除非主属性对键的部分依赖。大白话：不同实体的表不要存在一张表里</p>
<p>3NF：在2NF基础上，消除非主属性对键的传递依赖。大白话：不要有重复字段</p>
<h1 id="2-Mysql索引概述"><a href="#2-Mysql索引概述" class="headerlink" title="2.Mysql索引概述"></a>2.Mysql索引概述</h1><ul>
<li><p>What？</p>
<ul>
<li>帮助Mysql高效获取数据的数据结构。</li>
</ul>
</li>
<li><p>Why？</p>
<ul>
<li>加快查询速度。（否则只能全表扫描）</li>
<li>代价：额外的存储空间</li>
</ul>
</li>
<li><p>How？</p>
<ul>
<li>增：CREATE  &lt;索引类型&gt; INDEX &lt;索引的名字&gt; ON <table_name>(列的列表)；</li>
<li>删：DROP INDEX <index_name> ON <table_name>;</li>
<li>查：SHOW INDEX FROM <table_name>;</li>
<li><strong>强制指定索引</strong>：select &lt;列名&gt; from <table_name>  where &lt;查询条件&gt; force index(${index_name})</li>
</ul>
</li>
</ul>
<p>面试题1：当mysql执行计划选择错了索引，怎么办？</p>
<p>面试题2（非主流）：一个表最多可以可以新建多少个索引？16个？谈谈你对这个限制的理解</p>
<h2 id="Mysql索引类别【重点】"><a href="#Mysql索引类别【重点】" class="headerlink" title="Mysql索引类别【重点】"></a>Mysql索引类别【重点】</h2><ul>
<li><p>按照实现的数据结构区分：</p>
<ul>
<li><strong>B+树</strong>索引（InnoDB,MyISAM存储引擎）</li>
<li>Hash索引（Memory存储引擎等）</li>
<li>倒排索引（ InnoDB,MyISAM存储引擎针对全文索引）</li>
<li>LSM-Tree索引：Hbase、OceanBase的索引数据结构</li>
</ul>
</li>
<li><p>按照约束（或者创建语句）区分：</p>
<ul>
<li>普通索引： CREATE  INDEX</li>
<li>唯一索引： CREATE  UNIQUE INDEX</li>
<li>主键索引： 创建表自带， { PRIMARY KEY (<code>id</code>) }</li>
<li>全文索引： CREATE  FULLTEXT INDEX<strong>【没人用，ES替代】</strong></li>
</ul>
</li>
<li><p>按照索引列的数量区分：</p>
<ul>
<li>单列索引</li>
<li>联合索引（复合索引、组合索引）【最左匹配原则】</li>
</ul>
</li>
<li><p>按照存储的内容区分(innodb存储引擎)</p>
<ul>
<li>聚簇索引：存储了索引列与数据【索引即数据，数据即索引】</li>
<li>非聚簇索引（辅助索引&#x2F;二级索引）：存储了索引列与主键</li>
</ul>
</li>
</ul>
<p>检查理解情况：（判断题）</p>
<ol>
<li>主键索引是单列索引，也是聚餐索引。</li>
<li>使用CREATE INDEX语句创建的索引均为辅助索引。</li>
<li>聚餐索引存储了mysql表的所有的数据，支持按照主键查询。</li>
<li>使用Innodb存储引擎的表的主键索引是B+树索引。</li>
<li>使用Innodb存储引擎的表聚簇索引与非聚餐索引均采用B+树索引，存储原理是一致的。</li>
</ol>
<p><strong>注意：</strong></p>
<p>只有B树，B+树</p>
<p>B-树 &#x3D; B树，<strong>不要读B减树</strong></p>
<ul>
<li><p>面试题1：Key（键&#x2F;约束）与Index（索引）的区别与联系：</p>
<ul>
<li>Index：方便查询</li>
<li>Key：方便查询 + 约束（主键、唯一键、外键）</li>
</ul>
</li>
<li><p>最左匹配原则:以最左边的为起点任何连续的索引都可匹配</p>
</li>
<li><p>面试题2：</p>
</li>
<li><p>索引：index(a, b, c )</p>
</li>
<li><p>以下查询语句是否可以使用此索引：</p>
</li>
</ul>
<ol>
<li>where a &#x3D; 1：ok</li>
<li>where a &#x3D; 1 and c &#x3D; 1：索引效果与上面一样</li>
<li>where b &#x3D; 1：不ok</li>
<li>where a &#x3D; 1 and b &#x3D; 1 ：ok</li>
<li><strong>where b &#x3D; 1 and a &#x3D; 1：k【与条件先后顺序无关】</strong></li>
</ol>
<ul>
<li>面试题3：有哪些索引？</li>
</ul>
<h2 id="面试题-1"><a href="#面试题-1" class="headerlink" title="面试题"></a>面试题</h2><ul>
<li>mysql innodb等值查询除了会使用到B+树索引，还可能使用到什么索引？</li>
<li>谈谈哈希索引（自适应hash索引）<ul>
<li>哈希索引适合等值查询，但是无法进行范围查询</li>
<li>哈希索引没办法利用索引完成排序 </li>
<li>哈希索引不支持多列联合索引的最左匹配规则 </li>
<li>如果有大量重复键值的情况下，哈希索引的效率会很低，因为存在哈希碰撞问题</li>
<li>由innodb自行建立维护，DBA无法介入</li>
</ul>
</li>
<li>谈谈哈希索引与B+树索引的区别？</li>
</ul>
<h1 id="3-Innodb记录格式"><a href="#3-Innodb记录格式" class="headerlink" title="3.Innodb记录格式"></a>3.Innodb记录格式</h1><p><strong>行格式：</strong></p>
<ul>
<li><p>What 行？</p>
<ul>
<li>执行 insert into <table_name> values(&lt;值&gt;) 语句便向数据库插入了一条数据，此条数据称之为行或者记录</li>
</ul>
</li>
<li><p>What 行格式？</p>
<ul>
<li>存储上述行（或记录）在磁盘上的存放方式，即行格式&#x2F;记录格式</li>
</ul>
</li>
<li><p>How 行格式？</p>
<ul>
<li>指定：CREATE TABLE 表名 (列的信息) ROW_FORMAT&#x3D;行格式名称</li>
<li>修改：ALTER TABLE 表名 ROW_FORMAT&#x3D;行格式名称</li>
</ul>
</li>
<li><p>行格式的类型有哪些？</p>
<ul>
<li>Redundant：5.0-，冗余行格式，远古时期</li>
<li>Compact：5.6默认</li>
<li><strong>Dynamic</strong>：5.7+默认，动态行格式，和Compact区别不大，仅在行溢出情况下存在区别</li>
<li>Compressed：压缩行格式，采用压缩算法节约磁盘空间，仅在数据归档时才会使用</li>
</ul>
</li>
</ul>
<p><strong>Dynamic行格式【重点】</strong></p>
<p><img src="/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/3cd7d80a-ad09-489e-a1b6-c7aeac85cad1.png" srcset="/img/loading.gif" lazyload alt="示意图"></p>
<p><strong>记录存储在“页”中，一页16KB</strong></p>
<p>记录的额外信息：</p>
<ul>
<li>变长字段长度列表：变长字段（占用存储字节数不固定的字段，例如VARCHAR）的实际长度</li>
<li>NULL值列表：<ul>
<li>标示了哪些列：主键列、被NOT NULL修饰的列都是不可以存储NULL值，其他都存储</li>
<li>如何标示：二进制位的值为1时，代表该列的值为NULL；二进制位的值为0时，代表该列的值不为NULL</li>
<li>占用的字节数：必须用整数个字节的位表示（如果使用的二进制位个数不是整数个字节，则在字节的高位补0）</li>
</ul>
</li>
<li>记录头信息：占用5个字节（40位）<ul>
<li><strong>delete_mask：该记录是否被删除</strong></li>
<li><strong>next_record：下一条记录的相对位置（并不是插入顺序的下一条记录，而是按照主键值&#x2F;索引列值的下一条记录）</strong></li>
<li>record_type：记录类型， 0表示普通记录，1表示B+树非叶子节点记录，2表示最小记录，3表示最大记录</li>
<li>heap_no：当前记录所属的<strong>页</strong>号</li>
<li>其他（预留位1、预留位2、 min_rec_mask、 n_owned）</li>
</ul>
</li>
</ul>
<p>记录的真实数据：</p>
<ul>
<li>隐藏列：<ul>
<li><strong>row_id</strong>：行ID，非必须，无主键且无NOT NULL的UK时才会有</li>
<li>transaction_id：事务ID</li>
<li>roll_pointer：回滚指针</li>
</ul>
</li>
<li>数据列：存储真实的数据</li>
</ul>
<p><img src="/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/84d18ac1-f7c3-49be-b533-28b7ccae069e.png" srcset="/img/loading.gif" lazyload alt="示意图2"></p>
<p>其他概念-行溢出：当记录中的数据太多，当前页放不下的时候，会把多余的数据存储到其他页中的现象</p>
<p>面试题1：delete语句之后，空间会不会自动释放？</p>
<p>答：不会，会将此记录标记为己删除，页内已删除的记录做为一个<strong>垃圾链表</strong>，下次需要向此页插入数据时，优先使用此块空间。</p>
<p>面试题2：表创建时无主键，会怎么办？</p>
<p>答：</p>
<ol>
<li>首先选择第一个被NOT NULL修饰的UK索引做为聚簇索引</li>
<li>若无，则会在记录中添加隐藏列的row_id</li>
</ol>
<p>面试题3：为什么查询数据时不建议select *</p>
<ol>
<li>网络IO  2.  发生回表现象   3.  回表时命中溢出页</li>
</ol>
<h1 id="4-Innodb页格式"><a href="#4-Innodb页格式" class="headerlink" title="4.Innodb页格式"></a>4.Innodb页格式</h1><h2 id="索引页-x2F-数据页"><a href="#索引页-x2F-数据页" class="headerlink" title="索引页&#x2F;数据页"></a>索引页&#x2F;数据页</h2><p>页： InnoDB管理存储空间的基本单位，也是MySQL中磁盘和内存交互的基本单位，一个页的大小一般是16KB</p>
<p><img src="/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/49278afe-ad09-402b-b1d2-f47bbf9820aa.png" srcset="/img/loading.gif" lazyload alt="数据页/索引页格式示意图"></p>
<ul>
<li><p>文件头：File Header，页的一些通用信息</p>
<ul>
<li>页号</li>
<li>校验和：与页尾一起校验页是否完整，刷盘时首先写校验和，通过和文件尾的校验和一同判断是否存在同步一半的情况。</li>
<li><strong>上一个页的页号、下一个页的页号：组成B+树的双向链表</strong></li>
</ul>
</li>
<li><p>页头：Page Header，数据页专有的一些信息</p>
<ul>
<li>本页中的记录的数量（包括最小和最大记录以及标记为删除的记录）</li>
<li><strong>第一个已经标记为删除的记录地址【为了找到垃圾链表，插入数据】</strong></li>
<li><strong>还未使用的空间最小地址【为了插入数据】</strong></li>
<li>页类型等其他</li>
</ul>
</li>
<li><p><em>虚记录</em>：最小虚记录和最大虚记录</p>
<ul>
<li>最小虚记录：此记录的next_record指向本页中最小的记录</li>
<li>最大虚记录：指向本页中最大的记录的next_record指向此记录</li>
</ul>
</li>
<li><p><em>用户记录</em>*&#x2F;*<em>记录堆</em>：实际存储的记录内容，由一堆行记录组成</p>
<ul>
<li>既有有效记录，又有已删除的记录</li>
</ul>
</li>
<li><p>未分配空间：页中尚未使用的空间</p>
<ul>
<li>下次需要向此页插入数据时，若无垃圾链表，则会使用此块空间。</li>
</ul>
</li>
<li><p><em>页目录</em><em>&#x2F;Slot**区</em>：页中的某些记录的相对位置，为了快速查询</p>
</li>
<li><p>文件尾：与页头一起校验页是否完整</p>
</li>
</ul>
<p><img src="/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/9ee83e74-fffd-4868-a7a9-78da7001cb1b.png" srcset="/img/loading.gif" lazyload alt="示意图3"></p>
<h2 id="记录的页内插入"><a href="#记录的页内插入" class="headerlink" title="记录的页内插入"></a>记录的页内插入</h2><ul>
<li><p>插入位置：</p>
<ul>
<li>垃圾链表（页头记录了第一个已经标记为删除的记录地址）</li>
<li>未分配的空间（页头记录了还未使用的空间最小地址）</li>
</ul>
</li>
<li><p>插入策略：物理有序 vs 逻辑有序</p>
<ul>
<li>举例：依次插入顺序10、9、8</li>
</ul>
<p>物理有序：</p>
</li>
</ul>
<p><img src="/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/c603392e-8c89-44f1-992d-ee36fa0f21a2.png" srcset="/img/loading.gif" lazyload alt="物理有序"></p>
<p>逻辑有序：</p>
<p><img src="/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/98dadc07-8cf8-4362-9403-1e80d1a4904d.png" srcset="/img/loading.gif" lazyload alt="逻辑有序"></p>
<h2 id="记录的页分裂【重点】"><a href="#记录的页分裂【重点】" class="headerlink" title="记录的页分裂【重点】"></a>记录的页分裂【重点】</h2><ul>
<li>该页装不下怎么办？假设页10只能装下3条记录，现在要插入id&#x3D;4的记录</li>
</ul>
<p><img src="/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/image-20230624094252434.png" srcset="/img/loading.gif" lazyload alt="image-20230624094252434"></p>
<p>思考：<strong>为什么mysql主键不建议使用UUID</strong></p>
<ul>
<li>在对页中的记录进行增删改操作的过程中，我们必须通过一些诸如记录移动的操作来始终保证这个状态一直成立：<strong>下一个数据页中用户记录的主键值必须大于上一个页中用户记录的主键值</strong>。这个过程我们也可以称为页分裂。</li>
</ul>
<h2 id="记录的页内查找（了解）"><a href="#记录的页内查找（了解）" class="headerlink" title="记录的页内查找（了解）"></a><strong>记录的页内查找（了解）</strong></h2><p><img src="/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/image-20230624094451483.png" srcset="/img/loading.gif" lazyload alt="image-20230624094451483"></p>
<p><strong>问：此时查找id&#x3D;3的数据的时间复杂度是多少？</strong></p>
<h2 id="记录的页内二分查找（了解）"><a href="#记录的页内二分查找（了解）" class="headerlink" title="记录的页内二分查找（了解）"></a><strong>记录的页内二分查找（了解）</strong></h2><p><img src="/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/336a7b3f-3469-4bb8-9592-2c2584412b95.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>Slot区：也称Page Directory区，页<strong>目录</strong>区，记录页中的某些记录的相对位置。</li>
<li>Slot：槽，对于页内记录（含最大记录与最小记录，不包括标记为已删除的记录）进行<strong>分组</strong>，每个组的最后一条记录的地址偏移量即为槽。<ul>
<li>每个组的最后一条记录（也就是组内最大的那条记录）的头信息中的n_owned属性表示该记录拥有多少条记录</li>
</ul>
</li>
</ul>
<p><img src="/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/5acc62c9-e566-4504-9058-08543f2d65ce.jpeg" srcset="/img/loading.gif" lazyload></p>
<ul>
<li><p>分组依据：</p>
<ul>
<li>对于最小记录所在的分组只能有 1 条记录</li>
<li>最大记录所在的分组拥有的记录条数只能在 1~8 条之间</li>
<li>剩下的分组中记录的条数范围只能在是 4~8 条之间</li>
</ul>
</li>
<li><p>如何二分查找：O(Log2N)</p>
<ul>
<li><p>通过二分法确定该记录所在的槽，并找到该槽所在分组中主键值最小的那条记录二分过程：(high槽 + low槽) &#x2F; 2 得到当前槽，判断当前槽所指记录的大小，决定high&#x2F;low的变化查找主键值最小的那条记录：(high – 1)槽所指的记录的next_record</p>
</li>
<li><p>通过记录的next_record属性遍历该槽所在的组中的各个记录</p>
</li>
</ul>
</li>
</ul>
<h2 id="5-再看B-树索引【重点】"><a href="#5-再看B-树索引【重点】" class="headerlink" title="5.再看B+树索引【重点】"></a>5.<strong>再看B+树索引【重点】</strong></h2><p><strong>B+树聚簇索引</strong></p>
<ul>
<li><ol>
<li>页之间存在双向链表（通过页的文件头区域的“上一页的页号”与“下一页”页号）</li>
</ol>
<p><img src="/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/image-20230624095018218.png" srcset="/img/loading.gif" lazyload alt="image-20230624095018218"></p>
</li>
</ul>
<p>此时查找办法：从左到右遍历页，看当前记录是否在最小记录与最大记录之间，若不在则判断下一页，若在则在页内二分查找。</p>
<ul>
<li><ol start="2">
<li>给每个页建立个目录，记录“页的用户记录中最小的主键值”与页号</li>
</ol>
<p><img src="/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/image-20230624095038737.png" srcset="/img/loading.gif" lazyload alt="image-20230624095038737"></p>
</li>
</ul>
<p>此时的查找方法：在目录页二分查找（距离此记录最近的所在的页），再在目标页内，二分查找。</p>
<ul>
<li><ol start="3">
<li>“目录”太多，一页装不下，分多个页来装。</li>
</ol>
<p><img src="/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/a84807a4-42fb-4477-adfc-5ab136b63556.png" srcset="/img/loading.gif" lazyload></p>
</li>
</ul>
<p>此时的查找方法：先从根页查找“距离此记录最近的记录”所在的页，再到索引页“距离此记录最近的记录”，最后到叶子节点二分查找</p>
<ul>
<li>根节点：存放索引信息（或者称为目录项）的页</li>
<li>非叶子节点（内节点）：存放索引信息的页<ul>
<li>下一个数据页中用户记录的主键值必须大于上一个页中用户记录的主键值。</li>
</ul>
</li>
<li>叶子节点（外节点）：存放索引信息与<strong>实际数据</strong>的页<ul>
<li>下一个数据页中用户记录的主键值必须大于上一个页中用户记录的主键值。</li>
</ul>
</li>
</ul>
<p>Innodb的聚簇索引与非聚簇索引均采用此结构进行存储，区别在于：</p>
<ol>
<li>聚簇索引的叶子节点存储的是全量数据</li>
<li>非聚簇索引的叶子节点存储的是索引列的值 + 主键</li>
</ol>
<p>下一个数据页中用户记录的索引列值必须<strong>大于</strong>上一个页中用户记录的索引列值。</p>
<p>&#x3D;&gt;  </p>
<p><strong>非聚簇索引的存储的索引数据一定会有主键</strong>。</p>
<p><img src="/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/62031496-6d9c-4051-8514-24edf4aa3b0c.png" srcset="/img/loading.gif" lazyload></p>
<p>**如上图某非聚簇索引橙色为索引的key绿色为页号蓝色为主键 **</p>
<p>此时若插入索引key&#x3D;1的数据改插入到页4还是页5？</p>
<p>面试题：</p>
<p>表：user（id，name、sex）</p>
<p>查询条件： where name &#x3D; ？ and sex &#x3D;? order by id</p>
<p>为了高效查询，建立索引有4种方式，以下哪种最优？</p>
<ol>
<li>idx_name_sex_id（name、sex、id）</li>
<li>idx_sex_ name_ id （sex、name、id）</li>
<li>idx_sex_name（sex、name）</li>
<li>idx_name_sex （name、 sex）</li>
</ol>
<h1 id="6-索引的使用"><a href="#6-索引的使用" class="headerlink" title="6.索引的使用"></a>6.索引的使用</h1><h2 id="访问类型概述"><a href="#访问类型概述" class="headerlink" title="访问类型概述"></a>访问类型概述</h2><p>访问类型：也称访问方法，access method，MySQL执行查询语句的方式。</p>
<ul>
<li>使用全表扫描进行查询（all）</li>
<li>使用索引进行查询（const、ref、ref_or_null、range、index等）</li>
</ul>
<p>注意：<strong>数据量大的表，一定要避免all的发生</strong></p>
<h3 id="访问类型-const"><a href="#访问类型-const" class="headerlink" title="访问类型-const"></a>访问类型-const</h3><ul>
<li>const：<ul>
<li>直接利用主键值在聚簇索引中定位对应的一条记录</li>
<li>根据唯一辅助索引列来定位一条记录</li>
</ul>
</li>
</ul>
<p><img src="/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/73f050bf-37a5-48f4-9505-b22d818f2d2d.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/06430fec-9f61-45d6-84a5-d6bd991416a9.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="访问类型-ref【重点】"><a href="#访问类型-ref【重点】" class="headerlink" title="访问类型-ref【重点】"></a>访问类型-ref【重点】</h3><ul>
<li>ref：对某个普通的二级索引列与常数进行等值比较</li>
</ul>
<p><img src="/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/268b086b-6fba-4728-b54c-a3d73a225074.png" srcset="/img/loading.gif" lazyload></p>
<p>面试题：</p>
<ol>
<li>为什么不select *？</li>
<li>什么是索引覆盖？</li>
<li>为什么要尽量避免回表？</li>
</ol>
<h3 id="访问类型-ref-or-null"><a href="#访问类型-ref-or-null" class="headerlink" title="访问类型-ref_or_null"></a>访问类型-ref_or_null</h3><p><img src="/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/268b086b-6fba-4728-b54c-a3d73a225074-1687571895894-20.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="访问类型-range"><a href="#访问类型-range" class="headerlink" title="访问类型-range"></a>访问类型-range</h3><ul>
<li>range：区间查询，使用&#x3D;、&lt;&#x3D;&gt;、IN、NOT IN、IS NULL、IS NOT NULL、&gt;、&lt;、&gt;&#x3D;、&lt;&#x3D;、BETWEEN、!&#x3D;、 &lt;&gt;、like左匹配，就可以产生一个所谓的区间。</li>
</ul>
<p>举例：SELECT * FROM single_table WHERE key2 IN (1438, 6328) OR (key2 &gt;&#x3D; 38 AND key2 &lt;&#x3D; 79);</p>
<p><img src="/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/image-20230624095852531.png" srcset="/img/loading.gif" lazyload alt="image-20230624095852531"></p>
<h3 id="访问类型-index"><a href="#访问类型-index" class="headerlink" title="访问类型-index"></a>访问类型-index</h3><ul>
<li>index：查询的值以及返回的结果恰好在某个辅助索引里，但是无法通过索引列查询，全部扫描此索引。</li>
</ul>
<p>举例：</p>
<p>表：</p>
<p>CREATE TABLE single_table (</p>
<p>​    id INT NOT NULL AUTO_INCREMENT,</p>
<p>​    key1 VARCHAR(100),</p>
<p>​    key2 INT,</p>
<p>​    key3 VARCHAR(100),</p>
<p>​    key_part1 VARCHAR(100),</p>
<p>​    key_part2 VARCHAR(100),</p>
<p>​    key_part3 VARCHAR(100),</p>
<p>​    common_field VARCHAR(100),</p>
<p>​    PRIMARY KEY (id),</p>
<p>​    <strong>KEY</strong> <strong>idx_key_part(key_part1, key_part2, key_part3)</strong></p>
<p>) Engine&#x3D;InnoDB CHARSET&#x3D;utf8;</p>
<p>查询语句：SELECT <strong>key_part1, key_part2, key_part3</strong> FROM single_table WHERE key_part2 &#x3D; ‘abc’; </p>
<p>辅助索引的数据比聚簇索引的数据小，全表所描辅助索引，也是个不错的选择</p>
<h2 id="索引的注意事项"><a href="#索引的注意事项" class="headerlink" title="索引的注意事项"></a><strong>索引的注意事项</strong></h2><ol>
<li>ORDER BY子句里使用到了我们的索引列（但是 oder by a asc, b desc, c desc不行）</li>
<li>只为用于搜索、排序或分组的列创建索引</li>
<li>列的区分度大的列创建索引，重复数据多的字段不应设为索引</li>
<li>更新频繁的列不应设置索引</li>
<li>重复数据多的字段不应设为索引的例外情况（状态字段&#x3D;有效&#x2F;无效，仅根据“有效”查询时，可以建立）</li>
<li>联合索引，区分度大的列放在第一位</li>
<li>只有索引列在比较表达式中单独出现才可以适用索引 （ a &gt; 2 可以，a + 1 &gt; 1不行）</li>
<li>为了尽可能少的让聚簇索引发生页面分裂和记录移位的情况，建议让主键拥有AUTO_INCREMENT属性。</li>
<li>尽量使用覆盖索引进行查询，避免回表带来的性能损耗。</li>
<li>使用IN查询，IN的数量不能太大（&lt;&#x3D;2000），避免mysql走错索引</li>
<li>Mysql会根据I&#x2F;O成本以及CPU成本去估算，选择最终执行计划</li>
<li>LIKE 右模糊（like kw%）可以使用到索引，LIKE左模糊（like %kw） 、全模糊（like %kw%）无法使用到索引。</li>
</ol>
<p>神兵利器：</p>
<ul>
<li><strong>EXPLAIN</strong>：查看SQL的执行计划的结果。</li>
<li>optimizer trace：查看生成执行计划的整个过程。</li>
</ul>
<p><strong>面试题：</strong></p>
<ol>
<li><strong>如何判断SQL走的是哪个索引？</strong></li>
<li><strong>如何优化慢SQL？</strong></li>
<li><strong>建立索引有哪些注意事项？</strong></li>
</ol>
<h1 id="7-其他应该知道的知识点"><a href="#7-其他应该知道的知识点" class="headerlink" title="7.其他应该知道的知识点"></a>7.其他应该知道的知识点</h1><h2 id="innodb区-x2F-段-x2F-表空间"><a href="#innodb区-x2F-段-x2F-表空间" class="headerlink" title="innodb区&#x2F;段&#x2F;表空间"></a>innodb区&#x2F;段&#x2F;表空间</h2><p><img src="/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/e436a165-a427-4505-b89d-c10cbe2ebb71.jpeg" srcset="/img/loading.gif" lazyload></p>
<ul>
<li><p>区：连续的64个页就是一个区。</p>
<ul>
<li>设计的目的：一个区就是在物理位置上连续的64个页，物理连续，空间的局部性原理，发生连续IO几率更高。（利用磁盘预读原理）</li>
</ul>
</li>
<li><p>段：存储相同类型记录的区做为一个段，一个段会有256个区，一个表空间下会有多个段，如“叶子节点段”、“非叶子节点段”。</p>
<ul>
<li>设计的目的：范围查询，其实是对B+树叶子节点中的记录进行顺序扫描，而如果不区分叶子节点和非叶子节点，统统把节点代表的页面放到申请到的区中的话，进行范围扫描的效果就大打折扣。物理连续，空间的局部性原理，发生连续IO几率更高。</li>
</ul>
</li>
<li><p>表空间：为了更好的管理页，一个.idb结尾的表为一个独立表空间。</p>
</li>
</ul>
<h2 id="为什么使用B-树，不用B树-x2F-二叉树？"><a href="#为什么使用B-树，不用B树-x2F-二叉树？" class="headerlink" title="为什么使用B+树，不用B树&#x2F;二叉树？"></a><strong>为什么使用B+树，不用B树&#x2F;二叉树？</strong></h2><ol>
<li>二叉树的高度太高，每次查找都是一次磁盘IO，很慢；B+树是一个多路查找树，高度一般2-4层，矮胖，IO较少。</li>
<li>B+树仅在叶子节点存储数据，叶子节点之间有双向链表，范围扫描快，B树没有，B树的非叶子节点也存储数据。</li>
</ol>
<h2 id="索引下推（ICP）"><a href="#索引下推（ICP）" class="headerlink" title="索引下推（ICP）"></a>索引下推（ICP）</h2><ul>
<li><p>索引下推：5.6+，有效减少回表次数，从而提高效率。</p>
</li>
<li><p>例子：</p>
<ul>
<li>语句：select * from table where k1 &#x3D; a and k2 &#x3D; b，索引为idx_k12(k1, k2)</li>
<li>执行：innodb扫描到一条记录：k1 &#x3D; a , k2 &#x3D; c<ul>
<li>不使用ICP：innodb将此记录返回给mysql-server， mysql-server拿着主键去回表判断 k2 是否等于 b</li>
<li>使用ICP：innodb自行判断，无需mysql-server回表判断</li>
</ul>
</li>
</ul>
</li>
<li><p>区别：</p>
<ul>
<li>当你不使用ICP,通过使用非主键索引（普通索引or二级索引）进行查询，存储引擎通过索引检索数据，然后返回给MySQL服务器，服务器再判断是否符合条件。</li>
<li>使用ICP，当存在索引的列做为判断条件时，MySQL服务器将这一部分判断条件传递给存储引擎，然后存储引擎通过判断索引是否符合MySQL服务器传递的条件，只有当索引符合条件时才会将数据检索出来返回给MySQL服务器。</li>
</ul>
</li>
</ul>
<p><strong>进阶面试题：5.6之前为什么不下推？</strong></p>
<p><strong>所谓下推，不过是将MysqlServer做的事情下移至存储引擎来做，其实是一个很正常的操作，只不过Mysql在之前的版本，并没有把这部分判断条件传递给存储引擎，过于简单粗暴。</strong></p>
<h2 id="深翻页"><a href="#深翻页" class="headerlink" title="深翻页"></a>深翻页</h2><ul>
<li>现象：select * from table_name limit m,n;  当m很大时，查询性能急剧下降。</li>
<li>第一层原理：先读取符合where条件的前面m+n条记录，然后抛弃前m条，返回后面n条，所以m越大，偏移量越大，性能就越差。</li>
<li>第二层原理：mysql server与存储引擎的交互，首先根据索引定位到第一条，往后一条条数据往后扫描，每条数据mysql server再判断是否要用，丢弃掉了前面m条数据。</li>
<li>解决方案：<ul>
<li>优化前：select * from table_a limit 1000000, 10;</li>
<li>优化后：select * from table_a where id &gt; ${lastKey} limit 10;</li>
</ul>
</li>
<li>解决方案的局限性：<ul>
<li>1、没有总页数</li>
<li>2、只能上下翻页</li>
<li>3、id必须有序且唯一</li>
</ul>
</li>
</ul>
<h2 id="面试题-情景题"><a href="#面试题-情景题" class="headerlink" title="面试题-情景题"></a>面试题-情景题</h2><ul>
<li><p>生产环境Mysql数据库所在服务器CPU飙升，如何排查？</p>
</li>
<li><p>经验：mysql服务器的CPU飙升往往都是慢SQL导致的</p>
</li>
<li><p>问题转换 &#x3D;&gt; 如何找到慢SQL？</p>
</li>
<li><p>方法1：查看数据库的慢SQL日志  slow.log</p>
</li>
<li><p>方法2：查看CPU飙升的曲线，是从时候开始的，那段时间做了什么样的代码变更，查看查询的表与条件。</p>
</li>
</ul>
<h2 id="面试题-Mysql单表最多能存储多少数据？"><a href="#面试题-Mysql单表最多能存储多少数据？" class="headerlink" title="面试题-Mysql单表最多能存储多少数据？"></a>面试题-Mysql单表最多能存储多少数据？</h2><ul>
<li>业内经验：<ul>
<li>阿里巴巴《Java开发手册》：单表行数超过 500 万行或者单表容量超过 2GB，才推荐进行分库分表。</li>
<li>互联网圈流传：MySQL 单表数据量大于 2000 W行，性能会明显下降。</li>
</ul>
</li>
<li>Mysql单表最多能存储多少数据？<ul>
<li>理论上可存储多少：取决于主键的数据类型，int为2^32 - 1，bigint为2^64 - 1</li>
<li>实际上可存储多少：超过了多少将影响Mysql的性能</li>
</ul>
</li>
<li>分析：</li>
</ul>
<p>Mysql单表最多能存储多少数据？ &#x3D;&gt; Mysql单表数据量超过多少将较大的影响mysql的性能？</p>
<p>影响Mysql性能的主要原因是什么？&#x3D;&gt; 索引结构，B+树索引 &#x3D;&gt; B+树的什么属性影响了性能 &#x3D;&gt; 高度（一般2-3层，2-3次IO）</p>
<p><img src="/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/4ddd953d-850b-4b13-9e46-d1bdfa7aae1a.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="/2023/06/24/MySQL%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86/a35c6b4a-a161-4ced-824b-65260247bd1f.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>如何理解业内经验？DBA基于大多数场景的经验</li>
</ul>
<h2 id="其他基础知识"><a href="#其他基础知识" class="headerlink" title="其他基础知识"></a>其他基础知识</h2><ul>
<li>表的字符集要使用，utf8mb4</li>
<li>表的比较规则要大小写敏感（默认不敏感），以_cs结尾的比较规则</li>
<li>union与union all的区别</li>
<li>char与varhcar的区别</li>
<li>左连接，右连接，内连接的区别</li>
<li>Mysql时间&#x2F;日期的数据类型：<a target="_blank" rel="noopener" href="https://blog.51cto.com/u_15346415/3675766">https://blog.51cto.com/u_15346415/3675766</a></li>
<li>基础的SQL语句书写</li>
</ul>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Java%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB%EF%BC%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/" class="category-chain-item">Java知识体系，中间件</a>
  
  
    <span>></span>
    
  <a href="/categories/Java%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB%EF%BC%8C%E4%B8%AD%E9%97%B4%E4%BB%B6/Mysql/" class="category-chain-item">Mysql</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/MySQL/">#MySQL</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>MySQL索引原理</div>
      <div>http://example.com/2023/06/24/MySQL索引原理/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>子川</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年6月24日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/06/24/%E6%B1%82%E8%81%8C%E8%A7%84%E5%88%92/" title="求职规划">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">求职规划</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/06/24/Java%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB%E6%A0%91%E7%8A%B6%E5%9B%BE/" title="Java知识体系树状图">
                        <span class="hidden-mobile">Java知识体系树状图</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
